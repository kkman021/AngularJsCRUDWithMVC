@model IEnumerable<CRUD_XML_MVC.Models.Billing>
@{
    ViewBag.Title = "Index";
}
<script type="text/javascript" src="@Url.Content("~/Scripts/Billing/Billing.js")"></script>
<script src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.11.0.js" type="text/javascript"></script>
<link href="@Url.Content("~/Content/pagination.css")" rel="stylesheet">
<link href="@Url.Content("~/content/datepicker.css")" rel="Stylesheet" />
<h2>
    Index</h2>
<p>
    @Html.ActionLink("Create New", "Create")
</p>
<div ng-app="BillingApp" ng-controller="BillingCtrl" ng-switch="ShowMode" ng-init="InitData()">
    <div ng-switch-when="list">
        <fieldset>
            <legend>Searching</legend>
            <div class="editor-label">
                姓名：</div>
            <div class="editor-field">
                <input type="text" ng-model="pagingInfo.searchName" />
            </div>
            <button class="btn" ng-click="searchMode()">
                search</button>
        </fieldset>
        <table>
            <tr>
                <th>
                </th>
                <th>
                    Customer
                </th>
                <th>
                    JobType
                </th>
                <th>
                    Date
                </th>
                <th>
                    Description
                </th>
                <th>
                    Hours
                </th>
            </tr>
            <tr ng-repeat="Billing in Billings">
                <td>
                    <a ng-click="showDetail(Billing,'edit')">Edit</a>| <a ng-click="showDetail(Billing,'details')">
                        Details</a>| <a ng-click="GoDel(Billing.ID)">Delete</a>
                </td>
                <td>
                    <span ng-bind="Billing.Customer"></span>
                </td>
                <td>
                    <span ng-repeat="Job in JobTypes | filter: {id:Billing.JobType}" ng-bind="Job.name">
                    </span>
                </td>
                <td>
                    <span ng-bind="Billing.Date| date:'yyyy-MM-dd'"></span>
                </td>
                <td>
                    <span ng-bind="Billing.Description"></span>
                </td>
                <td>
                    <span ng-bind="Billing.Hours"></span>
                </td>
            </tr>
        </table>
        <pagination boundary-links="true" total-items="pagingInfo.totalItems" ng-model="pagingInfo.Currentpage"
            class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;"
            last-text="&raquo;" items-per-page="pagingInfo.itemsPerPage" ng-change="pageChanged()"></pagination>
    </div>
    <div ng-switch-when="details">
        <fieldset>
            <legend>Billing</legend>
            <div class="display-label">
                Customer</div>
            <div class="display-field">
                <span ng-bind="BillingDetail.ID"></span>
            </div>
            <div class="display-label">
                JobType</div>
            <div class="display-field">
                <span ng-repeat="Job in JobTypes | filter: {id:BillingDetail.JobType}" ng-bind="Job.name">
                </span>
            </div>
            <div class="display-label">
                Date</div>
            <div class="display-field">
                <span ng-bind="BillingDetail.Date| date:'yyyy-MM-dd'"></span>
            </div>
            <div class="display-label">
                Description</div>
            <div class="display-field">
                <span ng-bind="BillingDetail.Description"></span>
            </div>
            <div class="display-label">
                Hours</div>
            <div class="display-field">
                <span ng-bind="BillingDetail.Hours"></span>
            </div>
        </fieldset>
        <br />
        <a href="#" ng-click="showList()">Back to list</a>
    </div>
    <div ng-switch-when="edit">
        <fieldset>
            <legend>Billing</legend>
            <div class="editor-label">
                Customer
            </div>
            <div class="editor-field">
                <input type="hidden" ng-model="BillingDetail.ID" />
                <input type="text" ng-model="BillingDetail.Customer" ng-bind="BillingDetail.Customer">
            </div>
            <div class="editor-label">
                JobType
            </div>
            <div class="editor-field">
                <!-- 當ng-model 的型態 需與 要綁定的資料型態一致，以這裡來說 若Job.id型態為int 則 BillingDetail.JobType 型態也必須為int ，否則無法綁定-->
                <select ng-model="BillingDetail.JobType" ng-options="Job.id as Job.name for Job in JobTypes">
                </select>
            </div>
            <div class="editor-label">
                Date
            </div>
            <div class="editor-field">
                <input type="text" class="form-control" datepicker-popup="{{format}}" ng-model="BillingDetail.Date" is-open="opened" datepicker-options="dateOptions" close-text="Close" ng-click="open($event)"/>                
            </div>
            <div class="editor-label">
                Description
            </div>
            <div class="editor-field">
                <input type="text" ng-model="BillingDetail.Description">
            </div>
            <div class="editor-label">
                Hours
            </div>
            <div class="editor-field">
                <input type="number" ng-model="BillingDetail.Hours">
            </div>
            <div>
                <button class="btn" ng-click="edit(BillingDetail)">
                    edit</button>
            </div>
        </fieldset>
        <br />
        <a href="#" ng-click="showList()">Back to list</a>
    </div>
</div>
